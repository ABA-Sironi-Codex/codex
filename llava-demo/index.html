<!DOCTYPE html><html lang="it"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Llava demo - Codex</title><meta name="description" content="Test e risultati sulla demo del nuovo LLM opensource basato su Vicuna e distribuito da Microsoft."><meta name="generator" content="Publii Open-Source CMS for Static Site"><script type="text/javascript" async src="https://www.googletagmanager.com/gtag/js?id=G-RL28EM6KVR"></script><script type="text/javascript">window.dataLayer = window.dataLayer || [];
				  function gtag(){dataLayer.push(arguments);}
				  gtag('js', new Date());
				  gtag('config', 'G-RL28EM6KVR' );
				  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RL28EM6KVR"></script><script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RL28EM6KVR');</script><meta name="theme-color" content="#17181E" media="(prefers-color-scheme: dark)"><meta name="theme-color" content="#D73A42" media="(prefers-color-scheme: light)"><meta name="msapplication-navbutton-color" content="#D73A42"><meta name="apple-mobile-web-app-status-bar-style" content="#D73A42"><link rel="canonical" href="https://codex.accademiasironi.it/llava-demo/"><link rel="alternate" type="application/atom+xml" href="https://codex.accademiasironi.it/feed.xml"><link rel="alternate" type="application/json" href="https://codex.accademiasironi.it/feed.json"><meta property="og:title" content="Llava demo"><meta property="og:image" content="https://codex.accademiasironi.it/media/website/logo.png"><meta property="og:image:width" content="480"><meta property="og:image:height" content="480"><meta property="og:site_name" content="Codex"><meta property="og:description" content="Test e risultati sulla demo del nuovo LLM opensource basato su Vicuna e distribuito da Microsoft."><meta property="og:url" content="https://codex.accademiasironi.it/llava-demo/"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://codex.accademiasironi.it/media/website/favicon.png" type="image/png"><link rel="stylesheet" href="https://codex.accademiasironi.it/assets/css/style.css?v=980a63e32b7070b8b663ed8802ab074b"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://codex.accademiasironi.it/llava-demo/"},"headline":"Llava demo","datePublished":"2023-10-18T19:17","dateModified":"2023-12-11T19:18","image":{"@type":"ImageObject","url":"https://codex.accademiasironi.it/media/website/logo.png","height":480,"width":480},"description":"Test e risultati sulla demo del nuovo LLM opensource basato su Vicuna e distribuito da Microsoft.","author":{"@type":"Person","name":"Prof. Davide Riboli","url":"https://codex.accademiasironi.it/authors/dr/"},"publisher":{"@type":"Organization","name":"Prof. Davide Riboli","logo":{"@type":"ImageObject","url":"https://codex.accademiasironi.it/media/website/logo.png","height":480,"width":480}}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body><header class="header" id="js-header"><a class="logo" href="https://codex.accademiasironi.it/"><img src="https://codex.accademiasironi.it/media/website/logo.png" alt="Codex" width="480" height="480"> </a><a href="https://github.com/ABA-Sironi-Codex" class="btn btn--outline btn--icon github" aria-label="Github" title="Github"><svg height="22" width="22"><use xlink:href="https://codex.accademiasironi.it/assets/svg/svg-map.svg#github"></use></svg> Github</a></header><main><div class="container container--with-sidebar"><div class="sidebar js-sidebar"><nav class="sidebar__menu"><ul class="js-sidebar-menu"><li><a href="https://codex.accademiasironi.it/" title="Home">Home</a></li><li><a href="https://codex.accademiasironi.it/tag/" title="Tag Index">Tag Index</a></li><li><a href="https://codex.accademiasironi.it/info/" title="Info">Info</a></li></ul></nav></div><div class="content content--center"><article class="post post-blog"><header class="post-blog__header"><h1>Llava demo</h1><ul class="post-blog__meta"><li><address class="post-blog__author"><img src="https://codex.accademiasironi.it/media/website/dr.jpg" loading="eager" height="100" width="100" alt="Prof. Davide Riboli"> <a rel="author" href="https://codex.accademiasironi.it/authors/dr/">Prof. Davide Riboli</a></address></li><li><time datetime="2023-12-11T19:18">11 dicembre 2023</time></li><li>Published in: <a href="https://codex.accademiasironi.it/tag/intelligenza-artificiale/" class="post-blog__tag">intelligenza artificiale</a></li></ul></header><div class="post__entry"><p>Llava (<em>Large Language and Vision Assistant</em>) è un modello multimodale, addestrato da un gruppo di ricercatori Microsoft, in grado di sostenere dialoghi con esseri umani e riconoscere immagini, basato su <a href="https://lmsys.org/blog/2023-03-30-vicuna/">Vicuna</a> un modello linguistico <em>Open Source</em> già in grado di offrire il 90% della "qualità" di ChatGPT. </p><p><a href="https://www.microsoft.com/en-us/research/project/llava-large-language-and-vision-assistant/overview/">Microsoft</a> ha rilasciato il progetto sotto licenza <em>Open Source</em> e tutta la documentazione, i dati di addestramento e le istruzioni per l'installazione sono su <a href="https://github.com/haotian-liu/LLaVA">GitHub</a>. Le richieste <em>hardware</em> per una installazione non quantizzata sono piuttosto elevate per gli utenti domestici, ma si può comunque testare una demo gratuita.</p><ul><li><a href="https://llava.hliu.cc/" target="_blank" rel="noopener">Llava Demo (apre una nuova finestra)</a></li></ul><p>Ho fatto due test: nel primo ho chiesto a Llava di scrivere in italiano una breve descrizione di sé stesso e questa è la risposta che ho ottenuto.</p><ul><li><p><em>Mi chiamo Vicuna e sono un modello di intelligenza artificiale addestrato per fornire assistenza e rispondere alle domande in modo efficiente e utile. Sono stato creato da un team di esperti di intelligenza artificiale che hanno lavorato duramente per sviluppare un modello che potesse fornire informazioni accurate e pertinenti su una vasta gamma di argomenti.</em></p></li><li><p><em>Il mio addestramento è stato basato su un'enorme quantità di dati provenienti da diverse fonti, tra cui libri, articoli online, siti web e database. Grazie a questa vasta gamma di fonti, sono in grado di fornire informazioni accurate e dettagliate su una vasta gamma di argomenti, dalle scienze alla storia, dalla cultura alla tecnologia.</em></p></li><li><p><em>Il mio obiettivo principale è quello di fornire assistenza e supporto alle persone che hanno domande o problemi. Sono stato progettato per essere accessibile e utile, in modo che le persone possano chiedere le informazioni di cui hanno bisogno senza dover cercare in modo approfondito. Inoltre, posso comunicare in diverse lingue, tra cui l'italiano, il francese e l'inglese, il che rende il mio servizio ancora più accessibile a un pubblico più ampio.</em></p></li><li><p><em>Oltre a fornire informazioni, sono anche in grado di eseguire una serie di compiti, tra cui la generazione di testo, la traduzione ed il riconoscimento immagini. Questi compiti possono essere utili per la creazione di contenuti online, la generazione di report e la creazione di presentazioni.</em></p></li><li><p><em>In sintesi, sono un modello di intelligenza artificiale sempre in evoluzione e in continua migliorazione, il cui obiettivo principale è quello di fornire un servizio utile e di qualità alle persone che lo utilizzano.</em></p></li></ul><p>A parte l'uso di "migliorazione" al posto di miglioramento, il risultato è notevole. Nel secondo test ho chiesto (in inglese) a Llava di darmi qualche informazione su questa immagine, che ho generato con una mia IA durante una conferenza che ho tenuto insieme al <a href="https://www.accademiavenezia.it/docenti/317">prof. Baronciani</a> pochi giorni fa. Ho specificatamente chiesto di sapere se riteneva che fosse stata generata da un'altra IA e se vi riconosceva un particolare stile pittorico. Di seguito, le risposte.</p><figure><figure class="post__image post__image--center"><img loading="lazy" src="https://codex.accademiasironi.it/media/posts/7/004_LlavaDemo.jpg" alt="Il pescatore, Davide Riboli (Stable Diffusion, 2023)" width="2048" height="2048" sizes="(max-width: 749px) 100vw, 749px" srcset="https://codex.accademiasironi.it/media/posts/7/responsive/004_LlavaDemo-xs.webp 300w, https://codex.accademiasironi.it/media/posts/7/responsive/004_LlavaDemo-sm.webp 480w, https://codex.accademiasironi.it/media/posts/7/responsive/004_LlavaDemo-md.webp 749w"></figure><figcaption><i>Il pescatore</i>, Davide Riboli (Stable Diffusion, 2023)</figcaption></figure><ul><li><p><em>The image features a serene scene of a lake surrounded by trees, with a bench situated near the water. The bench is positioned under a large tree, providing shade and a peaceful spot to sit and enjoy the view. The lake is calm and reflects the beauty of the surrounding landscape, which includes a mountain range in the distance. The overall atmosphere of the scene is tranquil and inviting, making it an ideal location for relaxation and contemplation.</em></p></li><li><p><em>It is possible that the image is by Alex Colville, as his artwork often features tranquil landscapes and scenes of nature. However, without more information or a clear signature, it is difficult to confirm the artist's identity with certainty.</em></p></li><li><p><em>It is not possible to definitively determine if the image was created by an AI or not, as AI-generated images can be quite realistic and difficult to distinguish from real photographs. However, without more context or information about the image's creation process, it is not possible to say for sure whether it was created by an AI or not.</em></p></li></ul><p>Ho trovato interessante la presenza di una frase come: <em>an ideal location for relaxation and contemplation</em> che mi pare testimoni che, oltre al riconoscimento dei soggetti primi (alberi, lago, sedia), Llava è già in grado di descrivere anche l'atmosfera che una determinata immagine evoca.</p><footer><dl class="post__tag post-blog__tag"><dt>Tags:</dt><dd><a href="https://codex.accademiasironi.it/tag/intelligenza-artificiale/" title="intelligenza artificiale">intelligenza artificiale</a></dd></dl></footer></div></article><div class="banner banner--after-post"><p>&nbsp;</p><script src="https://giscus.app/client.js" data-repo="ABA-Sironi-Codex/codex" data-repo-id="R_kgDOKXrmIQ" data-category="Discussioni" data-category-id="DIC_kwDOKXrmIc4CZxRm" data-mapping="pathname" data-strict="1" data-reactions-enabled="1" data-emit-metadata="1" data-input-position="top" data-theme="preferred_color_scheme" data-lang="it" data-loading="lazy" crossorigin="anonymous" async></script><script>var giscus = document.querySelector("script[src*=giscus]")

    // Set palette on initial load
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "slate"
        ? "transparent_dark"
        : "light"

      // Instruct Giscus to set theme
      giscus.setAttribute("data-theme", theme) 
    }

    // Register event handlers after documented loaded
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "slate"
            ? "transparent_dark"
            : "light"

          // Instruct Giscus to change theme
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })</script></div></div></div></main><footer class="footer"><div><a class="footer__logo" href="https://codex.accademiasironi.it/"><img src="https://codex.accademiasironi.it/media/website/logo.png" alt="Codex"></a></div><div><div class="footer__copy">Codex by ABA "Sironi", Sassari (IT)</div><div class="footer__social"></div></div></footer><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true
   };</script><script defer="defer" src="https://codex.accademiasironi.it/assets/js/scripts.min.js?v=4e6cf1839e76dc1bb4cf5df8b29781e3"></script><script>var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><script defer="defer" src="https://codex.accademiasironi.it/assets/js/quicklink.umd.js?v=a52ee49fe4afff274f8c30fe880ddc13"></script><script>window.addEventListener('load', () =>{
      quicklink.listen();
      });</script><div class="pcb" data-behaviour="badge" data-behaviour-link="#cookie-settings" data-revision="1" data-config-ttl="90" data-debug-mode="false"><div role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="pcb-title" aria-describedby="pcb-txt" class="pcb__banner pcb__banner--bar"><div class="pcb__inner"><div id="pcb-title" role="heading" aria-level="2" class="pcb__title">Anche noi usiamo i cookie</div><div id="pcb-txt" class="pcb__txt">Questo sito utilizza i cookie esclusivamente per le metriche delle visite ricevute e non esegue alcun tipo di profilazione utente, né richiede alcun dato personale.<br>Il tuo consenso ci aiuta a migliorare la pubblicazione.</div><div class="pcb__buttons"><button type="button" class="pcb__btn pcb__btn--solid pcb__btn--accept">Ok</button></div></div></div><button class="pcb__badge" aria-label="Cookie Policy" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" width="40" height="40" viewBox="0 0 23 23" fill="currentColor"><path d="M21.41 12.71c-.08-.01-.15 0-.22 0h-.03c-.03 0-.05 0-.08.01-.07 0-.13.01-.19.04-.52.21-1.44.19-2.02-.22-.44-.31-.65-.83-.62-1.53a.758.758 0 0 0-.27-.61.73.73 0 0 0-.65-.14c-1.98.51-3.49.23-4.26-.78-.82-1.08-.73-2.89.24-4.49.14-.23.14-.52 0-.75a.756.756 0 0 0-.67-.36c-.64.03-1.11-.1-1.31-.35-.19-.26-.13-.71-.01-1.29.04-.18.06-.38.03-.59-.05-.4-.4-.7-.81-.66C5.1 1.54 1 6.04 1 11.48 1 17.28 5.75 22 11.6 22c5.02 0 9.39-3.54 10.39-8.42.08-.4-.18-.78-.58-.87Zm-9.81 7.82c-5.03 0-9.12-4.06-9.12-9.06 0-4.34 3.05-8 7.25-8.86-.08.7.05 1.33.42 1.81.24.32.66.67 1.38.84-.76 1.86-.65 3.78.36 5.11.61.81 2.03 2 4.95 1.51.18.96.71 1.54 1.18 1.87.62.43 1.38.62 2.1.62.05 0 .09 0 .13-.01-1.23 3.64-4.7 6.18-8.64 6.18ZM13 17c0 .55-.45 1-1 1s-1-.45-1-1 .45-1 1-1 1 .45 1 1Zm5.29-12.3a.99.99 0 0 1-.29-.71c0-.55.45-.99 1-.99a1 1 0 0 1 .71.3c.19.19.29.44.29.71 0 .55-.45.99-1 .99a1 1 0 0 1-.71-.3ZM9 13.5c0 .83-.67 1.5-1.5 1.5S6 14.33 6 13.5 6.67 12 7.5 12s1.5.67 1.5 1.5Zm3.25.81a.744.744 0 0 1-.06-1.05c.28-.32.75-.34 1.05-.06.31.28.33.75.05 1.06-.15.16-.35.25-.56.25-.18 0-.36-.06-.5-.19ZM8.68 7.26c.41.37.44 1 .07 1.41-.2.22-.47.33-.75.33a.96.96 0 0 1-.67-.26c-.41-.37-.44-1-.07-1.41.37-.42 1-.45 1.41-.08Zm11.48 1.88c.18-.19.52-.19.7 0 .05.04.09.1.11.16.03.06.04.12.04.19 0 .13-.05.26-.15.35-.09.1-.22.15-.35.15s-.26-.05-.35-.15a.355.355 0 0 1-.11-.16.433.433 0 0 1-.04-.19c0-.13.05-.26.15-.35Zm-4.93-1.86a.75.75 0 1 1 1.059-1.06.75.75 0 0 1-1.059 1.06Z"/></svg></button></div><script>(function(win) {
    if (!document.querySelector('.pcb')) {
        return;
    }

    var cbConfig = {
        behaviour: document.querySelector('.pcb').getAttribute('data-behaviour'),
        behaviourLink: document.querySelector('.pcb').getAttribute('data-behaviour-link'),
        revision: document.querySelector('.pcb').getAttribute('data-revision'),
        configTTL: parseInt(document.querySelector('.pcb').getAttribute('data-config-ttl'), 10),
        debugMode: document.querySelector('.pcb').getAttribute('data-debug-mode') === 'true',
        initialState: null,
        previouslyAccepted: []
    };

    var cbUI = {
        wrapper: document.querySelector('.pcb'),
        banner: {
            element: null,
            btnAccept: null,
            btnReject: null,
            btnConfigure: null
        },
        popup: {
            element: null,
            btnClose: null,
            btnSave: null,
            btnAccept: null,
            btnReject: null,
            checkboxes: null,
        },
        overlay: null,
        badge: null,
        blockedScripts: document.querySelectorAll('script[type^="gdpr-blocker/"]'),
        triggerLinks: cbConfig.behaviourLink ? document.querySelectorAll('a[href*="' + cbConfig.behaviourLink + '"]') : null
    };

    function initUI () {
        // setup banner elements
        cbUI.banner.element = cbUI.wrapper.querySelector('.pcb__banner');
        cbUI.banner.btnAccept = cbUI.banner.element.querySelector('.pcb__btn--accept');
        cbUI.banner.btnReject = cbUI.banner.element.querySelector('.pcb__btn--reject');
        cbUI.banner.btnConfigure = cbUI.banner.element.querySelector('.pcb__btn--configure');

        // setup popup elements
        if (cbUI.wrapper.querySelector('.pcb__popup')) {
            cbUI.popup.element = cbUI.wrapper.querySelector('.pcb__popup');
            cbUI.popup.btnClose = cbUI.wrapper.querySelector('.pcb__popup__close');
            cbUI.popup.btnSave = cbUI.popup.element.querySelector('.pcb__btn--save');
            cbUI.popup.btnAccept = cbUI.popup.element.querySelector('.pcb__btn--accept');
            cbUI.popup.btnReject = cbUI.popup.element.querySelector('.pcb__btn--reject');
            cbUI.popup.checkboxes = cbUI.popup.element.querySelector('input[type="checkbox"]');
            // setup overlay
            cbUI.overlay = cbUI.wrapper.querySelector('.pcb__overlay');
        }

        cbUI.badge = cbUI.wrapper.querySelector('.pcb__badge');

        if (cbConfig.behaviour.indexOf('link') > -1) {
            for (var i = 0; i < cbUI.triggerLinks.length; i++) {
                cbUI.triggerLinks[i].addEventListener('click', function(e) {
                    e.preventDefault();
                    showBannerOrPopup();
                });
            }
        }
    }

    function initState () {
        var lsKeyName = getConfigName();
        var currentConfig = localStorage.getItem(lsKeyName);
        var configIsFresh = checkIfConfigIsFresh();

        if (!configIsFresh || currentConfig === null) {
            if (cbConfig.debugMode) {
                console.log('🍪 Config not found, or configuration expired');
            }

            showBanner();
        } else if (typeof currentConfig === 'string') {
            if (cbConfig.debugMode) {
                console.log('🍪 Config founded');
            }

            showBadge();

            if (cbUI.popup.element) {
                var allowedGroups = currentConfig.split(',');
                var checkedCheckboxes = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');

                for (var j = 0; j < checkedCheckboxes.length; j++) {
                    var name = checkedCheckboxes[j].getAttribute('data-group-name');

                    if (name && name !== '-' && allowedGroups.indexOf(name) === -1) {
                        checkedCheckboxes[j].checked = false;
                    }
                }

                for (var i = 0; i < allowedGroups.length; i++) {
                    var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + allowedGroups[i] + '"]');

                    if (checkbox) {
                        checkbox.checked = true;
                    }

                    allowCookieGroup(allowedGroups[i]);
                }
            }
        }

        setTimeout(function () {
            cbConfig.initialState = getInitialStateOfConsents();
        }, 0);
    }

    function checkIfConfigIsFresh () {
        var lastConfigSave = localStorage.getItem('publii-gdpr-cookies-config-save-date');

        if (lastConfigSave === null) {
            return false;
        }

        lastConfigSave = parseInt(lastConfigSave, 10);

        if (lastConfigSave === 0) {
            return true;
        }

        if (+new Date() - lastConfigSave < cbConfig.configTTL * 24 * 60 * 60 * 1000) {
            return true;
        }

        return false;
    }

    function initBannerEvents () {
        cbUI.banner.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('banner');
            showBadge();
        }, false);

        if (cbUI.banner.btnReject) {
            cbUI.banner.btnReject.addEventListener('click', function (e) {
                e.preventDefault();
                rejectAllCookies();
                showBadge();
            }, false);
        }

        if (cbUI.banner.btnConfigure) {
            cbUI.banner.btnConfigure.addEventListener('click', function (e) {
                e.preventDefault();
                hideBanner();
                showAdvancedPopup();
                showBadge();
            }, false);
        }
    }

    function initPopupEvents () {
        if (!cbUI.popup.element) {
            return;
        }

        cbUI.overlay.addEventListener('click', function (e) {
            hideAdvancedPopup();
        }, false);

        cbUI.popup.element.addEventListener('click', function (e) {
            e.stopPropagation();
        }, false);

        cbUI.popup.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('popup');
        }, false);

        cbUI.popup.btnReject.addEventListener('click', function (e) {
            e.preventDefault();
            rejectAllCookies();
        }, false);

        cbUI.popup.btnSave.addEventListener('click', function (e) {
            e.preventDefault();
            saveConfiguration();
        }, false);

        cbUI.popup.btnClose.addEventListener('click', function (e) {
            e.preventDefault();
            hideAdvancedPopup();
        }, false);
    }

    function initBadgeEvents () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.addEventListener('click', function (e) {
            showBannerOrPopup();
        }, false);
    }

    initUI();
    initState();
    initBannerEvents();
    initPopupEvents();
    initBadgeEvents();

    /**
     * API
     */
    function addScript (src, inline) {
        var newScript = document.createElement('script');

        if (src) {
            newScript.setAttribute('src', src);
        }

        if (inline) {
            newScript.text = inline;
        }

        document.body.appendChild(newScript);
    }

    function allowCookieGroup (allowedGroup) {
        var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroup + '"]');
        cbConfig.previouslyAccepted.push(allowedGroup);
    
        for (var j = 0; j < scripts.length; j++) {
            addScript(scripts[j].src, scripts[j].text);
        }

        var groupEvent = new Event('publii-cookie-banner-unblock-' + allowedGroup);
        document.body.dispatchEvent(groupEvent);
        unlockEmbeds(allowedGroup);

        if (cbConfig.debugMode) {
            console.log('🍪 Allowed group: ' + allowedGroup);
        }
    }

    function showBannerOrPopup () {
        if (cbUI.popup.element) {
            showAdvancedPopup();
        } else {
            showBanner();
        }
    }

    function showAdvancedPopup () {
        cbUI.popup.element.classList.add('is-visible');
        cbUI.overlay.classList.add('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'false');
        cbUI.overlay.setAttribute('aria-hidden', 'false');
    }

    function hideAdvancedPopup () {
        cbUI.popup.element.classList.remove('is-visible');
        cbUI.overlay.classList.remove('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'true');
        cbUI.overlay.setAttribute('aria-hidden', 'true');
    }

    function showBanner () {
        cbUI.banner.element.classList.add('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'false');
    }

    function hideBanner () {
        cbUI.banner.element.classList.remove('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'true');
    }

    function showBadge () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.classList.add('is-visible');
        cbUI.badge.setAttribute('aria-hidden', 'false');
    }

    function getConfigName () {
        var lsKeyName = 'publii-gdpr-allowed-cookies';

        if (cbConfig.revision) {
            lsKeyName = lsKeyName + '-v' + parseInt(cbConfig.revision, 10);
        }

        return lsKeyName;
    }

    function storeConfiguration (allowedGroups) {
        var lsKeyName = getConfigName();
        var dataToStore = allowedGroups.join(',');
        localStorage.setItem(lsKeyName, dataToStore);

        if (cbConfig.configTTL === 0) {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', 0);

            if (cbConfig.debugMode) {
                console.log('🍪 Store never expiring configuration');
            }
        } else {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', +new Date());
        }
    }

    function getInitialStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 Initial state: ' + groups.join(', '));
        }

        return groups;
    }

    function getCurrentStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 State to save: ' + groups.join(', '));
        }

        return groups;
    }

    function getAllGroups () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        return groups;
    }

    function acceptAllCookies (source) {
        var groupsToAccept = getAllGroups();
        storeConfiguration(groupsToAccept);

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        if (cbUI.popup.element) {
            var checkboxesToCheck = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');

            for (var j = 0; j < checkboxesToCheck.length; j++) {
                checkboxesToCheck[j].checked = true;
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 Accept all cookies: ', groupsToAccept.join(', '));
        }

        if (source === 'popup') {
            hideAdvancedPopup();
        } else if (source === 'banner') {
            hideBanner();
        }
    }

    function rejectAllCookies () {
        if (cbConfig.debugMode) {
            console.log('🍪 Reject all cookies');
        }

        storeConfiguration([]);
        setTimeout(function () {
            window.location.reload();
        }, 100);
    }

    function saveConfiguration () {
        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('🍪 Save new config: ', groupsToAccept.join(', '));
        }

        if (reloadIsNeeded(groupsToAccept)) {
            setTimeout(function () {
                window.location.reload();
            }, 100);
            return;
        }

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        hideAdvancedPopup();
    }

    function reloadIsNeeded (groupsToAccept) {
        // check if user rejected consent for initial groups
        var initialGroups = cbConfig.initialState;
        var previouslyAcceptedGroups = cbConfig.previouslyAccepted;
        var groupsToCheck = initialGroups.concat(previouslyAcceptedGroups);

        for (var i = 0; i < groupsToCheck.length; i++) {
            var groupToCheck = groupsToCheck[i];

            if (groupsToAccept.indexOf(groupToCheck) === -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Reload is needed due lack of: ', groupToCheck);
                }

                return true;
            }
        }

        return false;
    }

    function unlockEmbeds (cookieGroup) {
        var iframesToUnlock = document.querySelectorAll('.pec-wrapper[data-consent-group-id="' + cookieGroup + '"]');

        for (var i = 0; i < iframesToUnlock.length; i++) {
            var iframeWrapper = iframesToUnlock[i];
            iframeWrapper.querySelector('.pec-overlay').classList.remove('is-active');
            iframeWrapper.querySelector('.pec-overlay').setAttribute('aria-hidden', 'true');
            var iframe = iframeWrapper.querySelector('iframe');
            iframe.setAttribute('src', iframe.getAttribute('data-consent-src'));
        }
    }

    win.publiiEmbedConsentGiven = function (cookieGroup) {
        // it will unlock embeds
        allowCookieGroup(cookieGroup);

        var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + cookieGroup + '"]');

        if (checkbox) {
            checkbox.checked = true;
        }

        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('🍪 Save new config: ', groupsToAccept.join(', '));
        }
    }
})(window);</script></body></html>